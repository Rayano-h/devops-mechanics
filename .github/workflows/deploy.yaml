name: Deploy MkDocs to Github Pages
on:                                                   # Quand est-ce qu'on déclenche ce workflow
  push:                                               # Lorsqu'il y a un push 
    branches:
      - main                                          # Sur la branche main uniquement    

permissions:                                          # Permissions nécessaires pour ce workflow
  contents: read                                      # Autoriser la lecture du code source (fichiers .md)
  pages: write                                        # Autoriser l'écriture/déployer sur GitHub Pages
  id-token: write                                     # Autoriser la génération d'un jeton d'identité pour l'authentification (OIDC)

jobs:                                                 # Listes des jobs (tâches) à exécuter
  build-and-deploy:                                   # Nom du job
    runs-on: ubuntu-latest                            # Environnement d'exécution (machine virtuelle)
    environment:
      name: github-pages                              # Environnement GitHub Pages pour le déploiement
      url: ${{ steps.deployment.outputs.page_url }}   # URL du site déployé  
    steps:                                            # Liste des étapes à exécuter dans ce job
      - name: Checkout repository                     # Étape 1 : Récupérer le code source du dépôt
        uses: actions/checkout@v4                     # Utiliser l'action officielle pour cloner le dépôt dans la VM

      - name: Set up Python                           # Étape 2 : Installer Python
        uses: actions/setup-python@v5
        with:                                         # Paramètres pour l'installation de Python
          python-version: '3.12'                      # Version de Python à utiliser

      - name: Install dependencies                    # Étape 3 : Installer les dépendances nécessaires
        run: |
          python -m pip install --upgrade pip
          pip install mkdocs mkdocs-material

      - name: Build MkDocs site                       # Étape 4 : Construire le site MkDocs
        run: mkdocs build

      - name: Setup pages                             # Étape 4.0 : Configurer GitHub Pages
        uses: actions/configure-pages@v4 

      - name: upload-pages-artifact                   # Étape 4.1 : Télécharger l'artéfact du site généré
        uses: actions/upload-pages-artifact@v3
        with:
          path: ./site                                # Répertoire contenant le site généré  

      - name: Deploy to GitHub Pages                  # Étape 5 : Déployer le site sur GitHub Pages
        id: deployment                         
        uses: actions/deploy-pages@v4


        # Récapitulatif du flux : 
        # Le workflow est déclenché par un push sur la branche main.
        #   ↓
        # 1. Checkout → Clone le code 
        #   ↓
        # 2. Set up Python → Installe Python 3.12
        #   ↓
        # 3. Install dependencies → Installe MkDocs et le thème Material
        #   ↓
        # 4. Build → Construit le site statique avec MkDocs (génère les fichiers dans ./site)
        #   ↓
        # 4.0 Setup pages → Configure GitHub Pages
        #   ↓
        # 4.1 Upload pages artifact → Empaquete le site dans ./site
        #   ↓
        # 5. Enfin, il déploie (publie) le site sur GitHub Pages.